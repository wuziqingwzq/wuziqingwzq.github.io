---
layout: post
title:  "树莓派学习（二）：系统初始化"
date:   2017-08-06 17:17:00 +0800
categories: RaspberryPi
tags: raspberry raspbian
---

## 系统类型
Raspbian是树莓派官方推荐系统中的一个，在安装完Rsapbian之后，如何连接系统开始使用成为一个问题，先说一下手上的工具。

1. 树莓派板子
2. USB电源5V 2A以上
3. Micro-USB电源线
4. SD卡
5. SD卡读卡器
6. HDML显示器
7. HDML线
8. USB鼠标
9. 无线路由器
10. 笔记本电脑（windows）
11. 一根网线

## 连接与初始化
在工具配备完整的情况下，使用树莓派就和使用正常电脑一样，插上显示器、键盘和鼠标就可以正常使用了，但是如果我缺少显示器、键盘、或者是网线的话，应该怎么连接？

以下我提供几个简单的思路，用于大家参考

### 仅有网线
在确定Rsapbian系统安装成功后，用网线将树莓派直接连接到笔记本上，通过笔记本电脑，将无线网络共享给树莓派固线（一定要有个WiFi，不然固线连接不会自动分配IP），并分配一个DHCP的地址，然后通过SSH连接到树莓派上，实现远程操作，这样就无需使用显示屏、键盘以及鼠标也可以开始折腾了。

具体操作如下：

* 确定树莓派系统安装正常并且已经启动成功了，由于我们没有显示器，无法看到桌面，只能观察树莓派的状态灯。正常运行时，树莓派的红灯（电源灯）是持续点亮的，而绿色灯在系统操作SD卡时会闪烁。因此正常使用应该是这样的：树莓派上电——>红灯持续点亮，同时绿灯点亮，期间伴随绿灯不规律闪烁——>
一分半左右，绿灯熄灭，红灯持续点亮。如果绿色灯一直亮着或者一直闪着，那树莓派启动可以失败了，建议连接显示屏来确认一下具体的问题。

* 在笔记本中配置无线网络共享。在你笔记本连接的Wifi中，点击属性——共享——勾选“允许其他网络用户通过此计算机的Internet连接来连接”（如果不知道这个设置怎么进入，百度一下“wifi网络连接属性”），此时会将固线网卡的IP设置为192.168.137.*网段。

![共享无线][共享无线]

* 在Windows command中输入以下命令可以扫描计算机的活动端口
```
arp -a
```

![活动IP][活动IP]

* 然后将网线一端插入笔记本，另一端插入树莓派，再次输入arp -a，观察是否有多出来的连接。注意：使用arp扫描有时候无法找到不活动的IP，具体原因我也不清楚，可以通过一些工具来进行扫描，比如说**MAC地址查询扫描器**等。下图中，动态IP就是使用arp指令扫描到的树莓派。

![活动IP2][活动IP2]



* 找到活动IP后，我们就可以通过SSH服务连接至树莓派。SSH服务是Secure Shell的缩写，需要在电脑上安装SSH客户端才能进行连接，我使用的是**PuTTY**，类似的软件还有Xshell等。


* **特别注意**：在最新的Raspbian系统版本中，比如我使用的2017-07的系统版本，SSH与VNC都是关闭的，即使网线连接成功，依然无法连接，会弹出提示
```
Netork error:Connection refused
网络错误，连接被拒绝
```
![连接拒绝][连接拒绝]

* SSH关闭的情况下，解决方式是将SD卡连接到电脑上，然后在SD中建立一个名为ssh的空文件（没有后缀名，不是ssh.txt），内核在启动时会自动开启SSH。

* 打开SSH之后，使用SSH客户端连接系统，填写树莓派的IP，点击连接。
![PuTTY][PuTTY]

* 连接成功之后，会提示输入用户名和密码，默认的账户密码如下，注意，在linux下输入密码，是不回显星号的，输入完之后点击回车就行。
```
pi
raspberry
```

![连接成功][连接成功]

* 一般来说，到上一步就结束了，但是初学时总是比较喜欢桌面操作的。可以使用以下指令开启VNC服务（Virtual Network Console，类似于远程桌面）。
```
vncserver   //开始VNC服务
vncserver -geometry 1280x768    //以1280*768分辨率开启VNC服务，注意中间是小写x，而不是星号或者乘号
```

* 可以开启多个VNC服务，连接的地址会变为192.168.1.100:1，192.168.1.100:2，依次累加。VNC连接也同样需要使用客户端，我再winows中使用的是**VNC Viewer**，在VNC Viewer客户端输入连接地址即可，效果如下。

![VNC客户端][VNC客户端]

### 有显示器和路由器
强烈建议在第一次初始化树莓派的时候，连接显示器看一看系统的情况，如果有鼠标的话，则会更加方便。

例如在开启VNC和SSH，可以在树莓派的桌面界面中配置，点击开始菜单（左上角）——Preferences（首选项）——Raspberry Configuration（树莓派配置）——Interface（接口）中，可以选择开启SSH和VNC。

![raspberryConfig][raspberryConfig]
![OpenSSH][OpenSSH]

而在系统的右上角，可以连接WiFi，并查看现在的IP地址。

![Wlan][Wlan]


[共享无线]: /assets/pic/2017-08-06/shareWifi.jpg
[活动IP]: /assets/pic/2017-08-06/scanPort.jpg
[活动IP2]: /assets/pic/2017-08-06/scanPort2.jpg
[连接拒绝]: /assets/pic/2017-08-06/sshError.jpg
[PuTTY]: /assets/pic/2017-08-06/PuTTY.jpg
[连接成功]: /assets/pic/2017-08-06/connection.jpg
[VNC客户端]: /assets/pic/2017-08-06/vncClient.jpg
[raspberryConfig]: /assets/pic/2017-08-06/raspberryConfiguration.jpg
[OpenSSH]: /assets/pic/2017-08-06/openSSH.jpg
[Wlan]: /assets/pic/2017-08-06/Wlan.jpg