---
layout: post
title:  "同时访问内网和外网的设置"
date:   2017-12-04 12:00:00 +0800
categories: middleware
tags: network
---
某些时候，计算机会出现同时访问公司内网与互联网系统的需求

一般来说有两条网线，需要访问外网时，插上外网网线，配置为（具体配置需要参考实际的网络情况，这里只是示例）：
```
192.168.1.100  #IP地址
255.255.255.0  #子网掩码Mask
192.168.1.1    #Gate网关
```
另一条内网网线，配置为：
```
10.0.30.100     #IP地址
255.255.255.0   #子网掩码Mask
10.0.30.1       ##Gate网关
```

连接不同网络需要插不同的网线，但是如果我需要同时访问网联网（QQ或者百度），也需要访问公司内部的服务（比如GIT），应该怎么处理呢？

假设我有两张网卡，无线网卡和有线网卡（通常笔记本的标准配置），连上了WIFI也插上了内网网线。

这个时候发现公司内部的地址（10.0.30.99）是无法访问的，这是因为笔记本通常会将WLAN作为默认的网卡，访问10.0.30.99时的请求会通过192.168.1.1这个网卡发出，当然无法找到服务。

![network][network]

我们现在需要做的设置一个路由，指引所有的内网访问都从左边的网卡走，而互联网的访问不受影响地从无线网卡出去。

由于所有的流量默认是从无线网卡出去的，我们可以跟踪一下内网的链路。

```
tracert 10.0.30.99
```

![tracert][tracert]

如果第一跳是192.168.1.1的话，说明是从无线路由出去的。通过以下指令指定10.0.X.X的访问都从10.0.30.1这个网关出去。

```
route add 10.0.0.0 mask 255.255.255.0 10.0.30.1
```
添加完成之后再跟踪一下，或者访问一下服务是否正常。使用该指令添加的路由表在下次重启后会失效，确定可以同时访问之后，可以添加-p参数作为静态路由表。

```
route -p add 10.0.0.0 mask 255.255.255.0 10.0.30.1
# route -p add ‘IP地址’ mask ‘子网掩码’ ‘内网网关’ 
```

[network]: /assets/pic/2017-12-04/network.png
[tracert]: /assets/pic/2017-12-04/tracert.png